<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio de Amigo Secreto</title>
    <style>
        :root {
            --primary: #c0392b;
            --secondary: #27ae60;
            --bg: #fdf2e9;
            --card-bg: #ffffff;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        h1 { color: var(--primary); margin-bottom: 1rem; }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.98); }

        .btn-add { background-color: var(--secondary); color: white; }
        .btn-draw { background-color: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-copy { background-color: #34495e; color: white; font-size: 12px; padding: 5px 10px; }

        ul { list-style: none; padding: 0; text-align: left; }
        li { 
            background: #f8f9fa; 
            margin: 5px 0; 
            padding: 10px; 
            border-radius: 5px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }

        .remove { color: var(--primary); cursor: pointer; font-weight: bold; }

        /* √Årea de Resultados (Links) */
        #result-area { display: none; margin-top: 20px; border-top: 2px dashed #ddd; padding-top: 20px; }
        .link-item { 
            background: #eafaf1; 
            border: 1px solid #d5f5e3;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            text-align: left;
        }
        .link-item p { margin: 0 0 5px 0; font-weight: bold; font-size: 14px; }

        /* Tela de Revela√ß√£o */
        #reveal-screen { display: none; }
        .reveal-box {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 10px;
            font-size: 1.5rem;
            display: none;
        }
        .eye-icon { font-size: 3rem; margin-bottom: 10px; display: block; }

    </style>
</head>
<body>

    <div class="container">
        <div id="organizer-screen">
            <h1>üéÖ Amigo Secreto</h1>
            <p>Adicione os participantes e gere os links.</p>
            
            <div class="input-group">
                <input type="text" id="nameInput" placeholder="Nome do participante..." onkeypress="handleEnter(event)">
                <button class="btn-add" onclick="addParticipant()">Adicionar</button>
            </div>

            <ul id="nameList"></ul>

            <button class="btn-draw" id="drawBtn" onclick="drawNames()" style="display:none;">Realizar Sorteio</button>

            <div id="result-area">
                <h3>Links Gerados! üîó</h3>
                <p style="font-size: 0.9rem; color: #666;">Copie o link abaixo e envie para a pessoa correspondente.</p>
                <div id="linksList"></div>
                <button onclick="reset()" style="margin-top:20px; background:#7f8c8d; color:white;">Reiniciar</button>
            </div>
        </div>

        <div id="reveal-screen">
            <h1>üéÅ Seu Amigo Secreto</h1>
            <p>Ol√°, <strong id="santa-name" style="color:var(--primary)"></strong>!</p>
            <p>Voc√™ tirou...</p>
            
            <button class="btn-add" onclick="revealTarget()">Ver quem eu tirei</button>
            
            <div id="target-reveal" class="reveal-box">
                </div>
            
            <br><br>
            <a href="?" style="font-size: 12px; color: #999;">Criar novo sorteio</a>
        </div>
    </div>

    <script>
        let participants = [];

        // Verifica se a p√°gina foi aberta com um "segredo" na URL
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const secret = params.get('s');

            if (secret) {
                // Modo Participante
                document.getElementById('organizer-screen').style.display = 'none';
                document.getElementById('reveal-screen').style.display = 'block';
                
                try {
                    // Decodifica o Base64
                    const decoded = atob(secret); // Decodifica string
                    const data = JSON.parse(decoded); // Transforma em objeto
                    
                    document.getElementById('santa-name').innerText = data.giver;
                    document.getElementById('target-reveal').innerText = data.receiver;
                } catch (e) {
                    alert("Link inv√°lido!");
                    window.location.href = window.location.pathname;
                }
            }
        };

        // --- L√≥gica do Organizador ---

        function handleEnter(e) {
            if (e.key === 'Enter') addParticipant();
        }

        function addParticipant() {
            const input = document.getElementById('nameInput');
            const name = input.value.trim();

            if (name && !participants.includes(name)) {
                participants.push(name);
                renderList();
                input.value = '';
                input.focus();
            } else if (participants.includes(name)) {
                alert("Esse nome j√° existe!");
            }
        }

        function removeParticipant(index) {
            participants.splice(index, 1);
            renderList();
        }

        function renderList() {
            const list = document.getElementById('nameList');
            const drawBtn = document.getElementById('drawBtn');
            list.innerHTML = '';

            participants.forEach((name, index) => {
                list.innerHTML += `
                    <li>
                        ${name}
                        <span class="remove" onclick="removeParticipant(${index})">&times;</span>
                    </li>
                `;
            });

            // S√≥ mostra bot√£o de sortear se tiver pelo menos 3 pessoas
            drawBtn.style.display = participants.length >= 3 ? 'block' : 'none';
        }

        function drawNames() {
            if (participants.length < 3) return alert("Adicione pelo menos 3 pessoas.");

            // L√≥gica de Sorteio (Circular para garantir que ningu√©m tire a si mesmo)
            // 1. Embaralha a lista original
            let shuffled = [...participants];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            // 2. Cria os pares: Indice 0 tira 1, 1 tira 2... Ultimo tira 0
            const linksContainer = document.getElementById('linksList');
            linksContainer.innerHTML = '';

            for (let i = 0; i < shuffled.length; i++) {
                const giver = shuffled[i];
                const receiver = shuffled[(i + 1) % shuffled.length]; // O √∫ltimo pega o primeiro

                // Gera o "segredo"
                const secretObj = { giver: giver, receiver: receiver };
                const secretString = btoa(JSON.stringify(secretObj)); // Codifica em Base64
                
                // Gera a URL completa
                const baseUrl = window.location.href.split('?')[0];
                const fullUrl = `${baseUrl}?s=${secretString}`;

                // Cria o elemento visual
                const div = document.createElement('div');
                div.className = 'link-item';
                div.innerHTML = `
                    <p>Link para <strong>${giver}</strong>:</p>
                    <div style="display:flex; gap:5px;">
                        <input type="text" value="${fullUrl}" readonly style="font-size:12px; color:#555;">
                        <button class="btn-copy" onclick="copyLink(this)">Copiar</button>
                    </div>
                `;
                linksContainer.appendChild(div);
            }

            document.getElementById('result-area').style.display = 'block';
            document.getElementById('drawBtn').style.display = 'none';
            document.getElementById('nameInput').disabled = true;
        }

        function copyLink(btnElement) {
            const input = btnElement.previousElementSibling;
            input.select();
            input.setSelectionRange(0, 99999); // Para mobile
            navigator.clipboard.writeText(input.value).then(() => {
                const originalText = btnElement.innerText;
                btnElement.innerText = "Copiado!";
                btnElement.style.background = "#27ae60";
                setTimeout(() => {
                    btnElement.innerText = originalText;
                    btnElement.style.background = "#34495e";
                }, 2000);
            });
        }

        // --- L√≥gica do Participante ---

        function revealTarget() {
            document.getElementById('target-reveal').style.display = 'block';
            // Confete opcional, se quiser implementar
        }
        
        function reset() {
            window.location.reload();
        }
    </script>
</body>
</html>